<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pinterest Username-Reuse Demo (Simulated)</title>
  <style>
    body{font-family:Inter,ui-sans-serif,system-ui,Arial;margin:24px;background:#f6f8fb;color:#0b1220}
    h1{font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:white;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(11,18,32,0.06)}
    .embed{border:1px dashed #d6dbe6;padding:10px;border-radius:8px;min-height:100px}
    .controls{margin-bottom:12px}
    button{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white;cursor:pointer;margin-right:8px}
    small.gray{color:#6b7280}
    pre{background:#0b122028;padding:10px;border-radius:6px;overflow:auto}
    .muted{color:#6b7280;font-size:13px}
  </style>
</head>
<body>
  <h1>Pinterest Username-Reuse Vulnerability — Interactive Demo (Simulated)</h1>
  <p class="muted">This is a <strong>local simulation</strong> — it does <em>not</em> call Pinterest. It demonstrates how embeds and API calls which reference usernames can be silently redirected if an old username is re-registered by an attacker.</p>

  <div class="controls">
    <button id="btn-change">Simulate: User changes username (old &rarr; new)</button>
    <button id="btn-register">Simulate: Attacker registers old username</button>
    <button id="btn-reset">Reset demo</button>
  </div>

  <div class="grid">
    <div class="card">
      <h3>1) Widget embed (HTML + pinit.js style)</h3>
      <div class="embed" id="widget-embed">
        <!-- This area shows what the official widget would render based on the username in the href -->
      </div>
      <p class="muted">HTML snippet used by site (hardcoded):</p>
      <pre id="widget-snippet">&lt;a data-pin-do="embedUser" href="https://www.pinterest.com/oldusername/"&gt;&lt;/a&gt; &lt;script src="//assets.pinterest.com/js/pinit.js"&gt;&lt;/script&gt;</pre>
    </div>

    <div class="card">
      <h3>2) "Pidgets" JSON endpoint (simulated)</h3>
      <div class="embed" id="pidgets-embed"></div>
      <p class="muted">Example endpoint: <code>/v3/pidgets/users/[username]/pins/</code></p>
      <p class="muted">Fetched JSON (simulated):</p>
      <pre id="pidgets-json"></pre>
    </div>

    <div class="card">
      <h3>3) REST API (v5) for account info (simulated)</h3>
      <div class="embed" id="rest-embed"></div>
      <p class="muted">Endpoint example: <code>/v5/user_account?username=[username]</code></p>
      <pre id="rest-json"></pre>
    </div>

    <div class="card">
      <h3>4) Direct image URL / static assets</h3>
      <div class="embed" id="image-embed" style="display:flex;gap:8px;flex-wrap:wrap;align-items:flex-start"></div>
      <p class="muted">Example image URL pattern: <code>i.pinimg.com/originals/.../[image].jpg</code></p>
    </div>
  </div>

  <hr />
  <h3>Notes for a real report</h3>
  <ul>
    <li>Include screenshots showing before/after on real third-party sites using widget code.</li>
    <li>List exact endpoints that still resolve by username (widget href, pidgets, REST v5, image URLs, conversions endpoints).</li>
    <li>Show automation that detects released usernames and reclaims them to demonstrate ease of exploitation.</li>
  </ul>

  <script>
    // === Simulated backend data ===
    const store = {
      // initial owner: victim
      'victim_profile': {
        username: 'oldusername', // initial username used in embeds
        display_name: 'Famous Brand (victim)',
        pins: [
          {id:'pin-1', title:'Product A', img:'https://via.placeholder.com/160x100?text=Brand-A'},
          {id:'pin-2', title:'Product B', img:'https://via.placeholder.com/160x100?text=Brand-B'},
        ]
      },
      // after user changes username (victim moves to newname)
      'victim_new': {
        username: 'newname',
        display_name: 'Famous Brand (victim)',
        pins: [
          {id:'pin-3', title:'New-Product X', img:'https://via.placeholder.com/160x100?text=Brand-New-X'}
        ]
      },
      // attacker claims the old username later
      'attacker': {
        username: 'oldusername',
        display_name: 'Evil Actor',
        pins: [
          {id:'evil-1', title:'Malicious Link', img:'https://via.placeholder.com/160x100?text=Evil'},
          {id:'evil-2', title:'NSFW', img:'https://via.placeholder.com/160x100?text=NSFW'}
        ]
      }
    };

    // Current mapping used by the 'live' Pinterest service simulation
    let liveUsernameMap = {
      // maps profile-id -> current username owner
      profile_for_site: 'victim_profile' // initially points to victim_profile which has username 'oldusername'
    };

    // Utility: render widget-like card based on the href value
    function renderWidget(hrefUsername) {
      const container = document.getElementById('widget-embed');
      container.innerHTML = '';
      // who currently owns that username in our simulated service?
      const owner = findOwnerByUsername(hrefUsername);
      if(!owner) {
        container.innerHTML = '<div class="muted">No content (username not found)</div>';
        return;
      }
      const h = document.createElement('div');
      h.innerHTML = '<strong>'+owner.display_name+'</strong> &middot; @'+owner.username+'<div style="display:flex;gap:8px;margin-top:8px"></div>';
      const grid = h.querySelector('div');
      owner.pins.forEach(p=>{
        const tile = document.createElement('div');
        tile.style.width='120px';tile.style.fontSize='13px';tile.style.textAlign='center';
        tile.innerHTML = `<img src="${p.img}" width="120" height="70" style="border-radius:6px;display:block;margin:0 auto 6px"/><div>${escapeHtml(p.title)}</div>`;
        grid.appendChild(tile);
      });
      container.appendChild(h);
    }

    // Simulate calling /v3/pidgets/users/[username]/pins/
    function fetchPidgets(username) {
      const el = document.getElementById('pidgets-json');
      const owner = findOwnerByUsername(username);
      if(!owner){
        el.textContent = JSON.stringify({error:'not found'},null,2);
        document.getElementById('pidgets-embed').innerHTML = '<div class="muted">No pins</div>';
        return;
      }
      const json = {
        username: owner.username,
        pins: owner.pins.map(p=>({id:p.id,title:p.title,image:p.img}))
      };
      el.textContent = JSON.stringify(json,null,2);
      // render
      const container = document.getElementById('pidgets-embed');
      container.innerHTML='';
      json.pins.forEach(p=>{
        const d = document.createElement('div');
        d.style.display='flex';d.style.gap='8px';d.style.marginBottom='8px';
        d.innerHTML = `<img src="${p.image}" width="90" height="60" style="border-radius:6px"/><div><strong>${escapeHtml(p.title)}</strong><br/><small class="gray">@${escapeHtml(json.username)}</small></div>`;
        container.appendChild(d);
      });
    }

    // Simulate /v5/user_account?username=...
    function fetchRestUser(username){
      const el = document.getElementById('rest-json');
      const owner = findOwnerByUsername(username);
      if(!owner){ el.textContent = JSON.stringify({error:'not found'},null,2); document.getElementById('rest-embed').innerHTML=''; return; }
      const json = {username: owner.username, display_name: owner.display_name, pins_count: owner.pins.length};
      el.textContent = JSON.stringify(json,null,2);
      document.getElementById('rest-embed').innerHTML = `<div><strong>${escapeHtml(json.display_name)}</strong> &middot; @${escapeHtml(json.username)}<div class="muted">pins: ${json.pins_count}</div></div>`;
    }

    // Render static image block by looking up owner's pins and loading their images
    function renderImages(username){
      const container = document.getElementById('image-embed');
      container.innerHTML='';
      const owner = findOwnerByUsername(username);
      if(!owner){ container.innerHTML='<div class="muted">No images (username not found)</div>'; return; }
      owner.pins.forEach(p=>{
        const img = document.createElement('img'); img.src=p.img; img.width=140; img.height=90; img.style.borderRadius='6px'; img.alt=p.title; container.appendChild(img);
      });
    }

    function findOwnerByUsername(username){
      // search store for matching username
      const keys = Object.keys(store);
      for(const k of keys){ if(store[k].username === username) return store[k]; }
      return null;
    }

    function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Initial href (site author hardcoded this when they dropped the widget)
    const hardcodedHref = 'oldusername';

    function renderAll(){
      // widget uses the hardcoded href
      renderWidget(hardcodedHref);
      // pidgets fetch
      fetchPidgets(hardcodedHref);
      // rest api
      fetchRestUser(hardcodedHref);
      // images
      renderImages(hardcodedHref);

      // also update the snippet text to show how the embed's href remains constant even after user changes
      document.getElementById('widget-snippet').textContent = `<a data-pin-do="embedUser" href="https://www.pinterest.com/${hardcodedHref}/"></a> <script src="//assets.pinterest.com/js/pinit.js"></script>`;
    }

    // === Actions to simulate timeline events ===
    document.getElementById('btn-change').addEventListener('click', ()=>{
      // simulate user changing username: we create mapping where the profile_for_site now points to victim_new, and victim_new has username 'newname'
      liveUsernameMap.profile_for_site = 'victim_new';
      alert('Simulated: victim changed username FROM oldusername TO newname.\n\nNote: the site still has the old username hardcoded; live service now maps oldusername -> ??? (unclaimed)');

      // In many services, the username "oldusername" would either be left free or pointers would redirect
      // For our simulation, we remove oldusername from owner records to indicate it is free now.
      store['victim_profile'].username = null; // old handle freed
      renderAll();
    });

    document.getElementById('btn-register').addEventListener('click', ()=>{
      // simulate attacker registering the old username
      // we set attacker.username to 'oldusername' and that makes findOwnerByUsername('oldusername') return attacker.
      store['attacker'].username = 'oldusername';
      // NOTE: in the real world, Pinterest's live mapping would now return attacker content for the old username.
      alert('Simulated: Attacker has registered oldusername. Now any embed or API call that uses the literal username oldusername will return attacker content.');
      renderAll();
    });

    document.getElementById('btn-reset').addEventListener('click', ()=>{
      // restore initial state
      store['victim_profile'].username = 'oldusername';
      store['victim_profile'].display_name = 'Famous Brand (victim)';
      store['victim_profile'].pins = [
        {id:'pin-1', title:'Product A', img:'https://via.placeholder.com/160x100?text=Brand-A'},
        {id:'pin-2', title:'Product B', img:'https://via.placeholder.com/160x100?text=Brand-B'}
      ];
      store['victim_new'].username = 'newname';
      store['attacker'].username = null;
      liveUsernameMap.profile_for_site = 'victim_profile';
      renderAll();
    });

    // initialize
    renderAll();
  </script>
</body>
</html>
